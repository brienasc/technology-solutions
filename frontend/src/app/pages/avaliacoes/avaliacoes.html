<app-header></app-header>

<div class="page-container">

    <header class="header-section">
        <div class="info-text">
            <h2>AvaliaÃ§Ãµes</h2>
            <p>
                Gerencie as avaliaÃ§Ãµes do curso 
                <span *ngIf="carregandoCurso" class="loading-dots">...</span>
                <span *ngIf="!carregandoCurso">{{ cursoNome }}</span>
            </p>
        </div>
        <button class="btn-new-avaliacao" (click)="abrirModalNovaAvaliacao()">
            + Nova AvaliaÃ§Ã£o
        </button>
    </header>

    <section class="summary-cards">
    <div class="card">
        <div class="card-icon icon-document">
            <mat-icon>description</mat-icon> 
        </div>
        <h3>{{ totalAvaliacoes }}</h3>
        <p>Total de AvaliaÃ§Ãµes</p>
    </div>
    <div class="card">
        <div class="card-icon icon-calendar">
            <mat-icon>calendar_today</mat-icon> 
        </div>
        <h3>{{ agendadasCount }}</h3>
        <p>Agendadas</p>
    </div>
    <div class="card">
        <div class="card-icon icon-progress">
            <mat-icon>schedule</mat-icon> 
        </div>
        <h3>{{ emAndamentoCount }}</h3>
        <p>Em Andamento</p>
    </div>
    <div class="card">
        <div class="card-icon icon-completed">
            <mat-icon>check_circle_outline</mat-icon> 
        </div>
        <h3>{{ finalizadasCount }}</h3>
        <p>Finalizadas</p>
    </div>
</section>

    <!-- Filtros -->
    <section class="filters-section">
        <div class="search-input-group">
            <span class="search-icon">ğŸ”</span>
            <input 
                type="text" 
                placeholder="Buscar avaliaÃ§Ãµes..."
                [(ngModel)]="searchTerm"
                (keyup.enter)="buscarAvaliacoes()">
        </div>
        <select class="filter-select" [(ngModel)]="filtroTipo" (change)="aplicarFiltros()">
            <option value="todos">Todos os Tipos</option>
            <option value="prova">Prova</option>
        </select>
        <select class="filter-select" [(ngModel)]="filtroStatus" (change)="aplicarFiltros()">
            <option value="todos">Todos os Status</option>
            <option value="agendada">Agendadas</option>
            <option value="em_andamento">Em Andamento</option>
            <option value="finalizada">Finalizadas</option>
        </select>
        <button class="btn-filter" (click)="aplicarFiltros()">
            <span class="filter-icon">âš™ï¸</span> Aplicar Filtros
        </button>
    </section>

    <!-- Lista de AvaliaÃ§Ãµes -->
    <section class="avaliacoes-list">
        <!-- Loading -->
        <div *ngIf="carregandoAvaliacoes" class="loading-state">
            <div class="loading-spinner"></div>
            <p>Carregando avaliaÃ§Ãµes...</p>
        </div>


    <div *ngIf="!carregandoAvaliacoes && avaliacoes.length === 0" class="empty-state">
    <div class="empty-icon-container">
        <mat-icon class="empty-state-icon">edit_note</mat-icon>
    </div>
    <h3>Nenhuma avaliaÃ§Ã£o encontrada</h3>
    <p>Crie sua primeira avaliaÃ§Ã£o clicando no botÃ£o "Nova AvaliaÃ§Ã£o"</p>
</div>

        <!-- Lista de avaliaÃ§Ãµes -->
        <div *ngFor="let avaliacao of avaliacoes" class="avaliacao-item">
            <div class="avaliacao-details">
                <span class="doc-icon">ğŸ“„</span>
                <div>
                    <h4>{{ avaliacao.nome }}</h4>
                    <p>{{ 
                        avaliacao.tipo === 'prova' ? 'Prova avaliativa' : 
                        avaliacao.tipo === 'simulado' ? 'Simulado prÃ¡tico' : 
                        avaliacao.tipo === 'atividade' ? 'Atividade de exercÃ­cios' :
                        'AvaliaÃ§Ã£o'
                    }}</p>
                    <div class="meta-info">
                        <span>ğŸ“… {{ formatarData(avaliacao.data_agendada) }}</span>
                        <span>ğŸ•’ {{ calcularTempo(avaliacao.tempo_duracao) }}</span>
                        <span>{{ avaliacao.quantidade_itens }} questÃµes</span>
                        <span>ğŸ‘¥ {{ avaliacao.alunos_previstos || 0 }} alunos</span>
                    </div>
                </div>
                <span class="status-badge status-{{ getStatusCssClass(avaliacao.status) }}">
                    {{ 
                        avaliacao.status === 'em_andamento' ? 'Em Andamento' : 
                        avaliacao.status === 'agendada' ? 'Agendada' :
                        avaliacao.status === 'finalizada' ? 'Finalizada' :
                        avaliacao.status 
                    }}
                </span>
                <span class="type-badge">{{ avaliacao.tipo || 'prova' }}</span>
            </div>

            <div class="avaliacao-actions">
                <button (click)="visualizar(avaliacao)">ğŸ‘ï¸ Visualizar</button>
                <button (click)="editar(avaliacao)">âœï¸ Editar</button>
                <button *ngIf="avaliacao.status === 'finalizada'" (click)="relatorio(avaliacao)">ğŸ“Š RelatÃ³rio</button>
                <button (click)="excluir(avaliacao)" class="btn-excluir">ğŸ—‘ï¸ Excluir</button>
            </div>
        </div>
    </section>

    <!-- Modal -->
    <app-modal-nova-avaliacao 
        *ngIf="showModal" 
        (closeModal)="fecharModal()" 
        (avaliacaoCriada)="onAvaliacaoCriada()"
        [cursoId]="cursoId">
    </app-modal-nova-avaliacao>

    <!-- Modal de Alerta -->
    <app-alert-modal
        [open]="showAlert"
        [title]="alertTitle"
        [message]="alertMessage"
        [variant]="alertVariant"
        [actions]="alertActions"
        (action)="onAlertAction($event)"
        (closed)="onAlertClosed()">
    </app-alert-modal>
<app-modal-detalhes-avaliacao 
  *ngIf="showModalDetalhes && avaliacaoSelecionada"
  [avaliacao]="avaliacaoSelecionada"
  (closeModal)="fecharModalDetalhes()">
</app-modal-detalhes-avaliacao>
    
</div>