<app-header></app-header>
<app-accessibility-bar></app-accessibility-bar>

<div class="cursos-container">
  <div class="header-section">
    <div class="header-text-group">
      <h1>Cursos</h1>
    </div>

    <button
      class="create-course-button"
      (click)="openCursoDialog()"
      aria-label="Adicionar Novo Curso"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
        aria-hidden="true"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M12 4v16m8-8H4"
        ></path>
      </svg>
      Adicionar Curso
    </button>
  </div>

  <div class="message-container" *ngIf="showSuccessMessage || showErrorMessage">
    <div
      class="success-message"
      *ngIf="showSuccessMessage"
      role="alert"
      aria-live="assertive"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
        aria-hidden="true"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M5 13l4 4L19 7"
        ></path>
      </svg>
      {{ successMessageText }}
    </div>

    <div
      class="error-message"
      *ngIf="showErrorMessage"
      role="alert"
      aria-live="assertive"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
        aria-hidden="true"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M6 18L18 6M6 6l12 12"
        ></path>
      </svg>
      {{ errorMessageText }}
    </div>
  </div>

  <!-- Container da tabela com controles integrados -->
  <div class="table-container">
    <!-- Novo cabeçalho com filtros integrados -->
    <div class="table-header">
      <div class="table-title">
        <h2>Lista de Cursos</h2>
        <span class="course-count">{{ totalItems }} cursos encontrados</span>
      </div>
      <div class="table-filters">
        <div class="filter-group">
          <div class="search-box">
            <input
              type="text"
              id="searchTerm"
              [(ngModel)]="searchTerm"
              (input)="onSearchChange()"
              placeholder="Buscar por nome do curso..."
            />
            <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
            </svg>
          </div>
          <div class="select-box">
            <select
              id="statusFilter"
              [(ngModel)]="statusFilter"
              (change)="onStatusFilterChange()"
              class="status-select"
            >
              <option value="all">Todos os status</option>
              <option value="Ativo">Ativo</option>
              <option value="Inativo">Inativo</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- Nova tabela com design moderno -->
    <div class="table-responsive">
      <table class="data-table" aria-label="Lista de Cursos Cadastrados">
        <thead>
          <tr>
            <th scope="col" class="th-nome">NOME</th>
            <th scope="col" class="th-descricao">DESCRIÇÃO</th>
            <th scope="col" class="th-carga">CARGA HORÁRIA</th>
            <th scope="col" class="th-status">STATUS</th>
            <th scope="col" class="th-actions text-end">AÇÕES</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngIf="loading" class="loading-row">
            <td colspan="5">
              <div class="loading-container">
                <div class="loading-spinner"></div>
                <span>Carregando cursos...</span>
              </div>
            </td>
          </tr>

          <tr *ngIf="!loading && paginatedCursos.length === 0" class="empty-row">
            <td colspan="5">
              <div class="empty-container">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/>
                </svg>
                <span>Nenhum curso encontrado</span>
              </div>
            </td>
          </tr>

          <tr *ngFor="let curso of paginatedCursos" class="data-row">
            <td class="td-nome">{{ curso.nome }}</td>
            <td class="td-descricao">{{ curso.descricao || "Sem descrição" }}</td>
            <td class="td-carga">{{ curso.carga_horaria }}h</td>
            <td class="td-status">
              <span
                class="status-badge"
                [ngClass]="curso.status ? 'status-ativo' : 'status-inativo'"
              >
                <svg *ngIf="curso.status" class="status-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <svg *ngIf="!curso.status" class="status-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                {{ curso.status ? "Ativo" : "Inativo" }}
              </span>
            </td>
            <td class="td-actions text-end">
              <div class="actions-container">
                <button
                  class="action-button edit-button"
                  (click)="openCursoDialog(curso)"
                  title="Editar {{ curso.nome }}"
                  aria-label="Editar curso: {{ curso.nome }}"
                >
                  <svg class="action-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
                  </svg>
                </button>
                <button
                  class="action-button delete-button"
                  (click)="deleteCurso(curso)"
                  title="Deletar {{ curso.nome }}"
                  aria-label="Deletar curso: {{ curso.nome }}"
                >
                  <svg class="action-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                  </svg>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Paginator -->
    <div class="pagination-container">
      <div class="pagination-info">
        <div class="items-per-page">
          <label for="itemsPerPage">Itens por página:</label>
          <select
            id="itemsPerPage"
            [(ngModel)]="itemsPerPage"
            (change)="onPageSizeChange()"
          >
            <option value="5">5</option>
            <option value="10">10</option>
            <option value="25">25</option>
            <option value="50">50</option>
          </select>
        </div>
      </div>

      <div class="pagination-range">
        <span
          >{{ getStartIndex() }} - {{ getEndIndex() }} de {{ totalItems }}</span
        >
      </div>

      <div class="pagination-controls">
        <button
          class="pagination-btn"
          [disabled]="currentPage === 1"
          (click)="goToPage(1)"
          title="Primeira página"
          aria-label="Ir para a primeira página"
        >
          <svg
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="m11 17-5-5 5-5M18 17l-5-5 5-5" />
          </svg>
        </button>

        <button
          class="pagination-btn"
          [disabled]="currentPage === 1"
          (click)="goToPrevious()"
          title="Página anterior"
          aria-label="Ir para a página anterior"
        >
          <svg
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="m15 18-6-6 6-6" />
          </svg>
        </button>

        <button
          class="pagination-btn"
          [disabled]="currentPage === lastPage"
          (click)="goToNext()"
          title="Próxima página"
          aria-label="Ir para a próxima página"
        >
          <svg
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="m9 18 6-6-6-6" />
          </svg>
        </button>

        <button
          class="pagination-btn"
          [disabled]="currentPage === lastPage"
          (click)="goToPage(lastPage)"
          title="Última página"
          aria-label="Ir para a última página"
        >
          <svg
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="m6 17 5-5-5-5M13 17l5-5-5-5" />
          </svg>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal de curso (mantém igual) -->
<div
  class="modal-overlay"
  [class.active]="showCursoDialog"
  *ngIf="showCursoDialog"
>
  <div class="modal-dialog" [class.active]="showCursoDialog">
    <div class="modal-header">
      <h2>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          class="modal-icon"
          aria-hidden="true"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"
          />
        </svg>
        {{ isEditMode ? "Editar Curso" : "Adicionar Curso" }}
      </h2>
      <button
        class="close-modal-btn"
        (click)="closeCursoDialog()"
        aria-label="Fechar modal"
      >
        ×
      </button>
    </div>

    <div class="modal-body">
      <div
        class="message-container"
        *ngIf="showSuccessMessage || showErrorMessage"
      >
        <div class="success-message" *ngIf="showSuccessMessage">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            aria-hidden="true"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M5 13l4 4L19 7"
            ></path>
          </svg>
          {{ successMessageText }}
        </div>

        <div class="error-message" *ngIf="showErrorMessage">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            aria-hidden="true"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"
            ></path>
          </svg>
          {{ errorMessageText }}
        </div>
      </div>

      <!-- Formulário do curso -->
      <div class="form-group">
        <label for="nome">Nome do Curso *</label>
        <input
          type="text"
          id="nome"
          [(ngModel)]="cursoForm.nome"
          class="form-control"
          [class.error]="formErrors.nome"
          placeholder="Digite o nome do curso"
        />
        <span class="error-text" *ngIf="formErrors.nome">{{
          formErrors.nome
        }}</span>
      </div>

      <div class="form-group">
        <label for="descricao">Descrição</label>
        <textarea
          id="descricao"
          [(ngModel)]="cursoForm.descricao"
          class="form-control"
          rows="3"
          placeholder="Digite uma descrição para o curso"
        ></textarea>
      </div>

      <div class="form-group">
        <label for="carga_horaria">Carga Horária (horas)</label>
        <input
          type="number"
          id="carga_horaria"
          [(ngModel)]="cursoForm.carga_horaria"
          class="form-control"
          [class.error]="formErrors.carga_horaria"
          min="0"
          placeholder="0"
        />
        <span class="error-text" *ngIf="formErrors.carga_horaria">{{
          formErrors.carga_horaria
        }}</span>
      </div>

      <div class="form-group">
        <label for="status">Status *</label>
        <select
          id="status"
          [(ngModel)]="cursoForm.status"
          class="form-select"
          [class.error]="formErrors.status"
        >
          <option value="">Selecione um status</option>
          <option *ngFor="let status of statusOptions" [value]="status.value">
            {{ status.label }}
          </option>
        </select>
        <span class="error-text" *ngIf="formErrors.status">{{
          formErrors.status
        }}</span>
      </div>
    </div>

    <div class="modal-actions">
      <button
        class="cancel-button"
        (click)="closeCursoDialog()"
        [disabled]="cursoLoading"
      >
        Cancelar
      </button>
      <button
        class="save-button"
        (click)="saveCurso()"
        [disabled]="cursoLoading"
      >
        <span
          *ngIf="cursoLoading"
          class="loading-spinner"
          aria-hidden="true"
        ></span>
        {{ isEditMode ? "Atualizar" : "Salvar" }}
      </button>
    </div>
  </div>
</div>
