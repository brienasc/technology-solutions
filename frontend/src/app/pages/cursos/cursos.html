<app-header></app-header>
<div class="cursos-container">
  <!-- Seção do cabeçalho -->
  <div class="header-section">
    <div class="header-text-group">
      <h1>Cursos</h1>
    </div>
    
    <button class="create-course-button" (click)="openCursoDialog()">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
      </svg>
      Adicionar Curso
    </button>
  </div>

  <!-- Mensagens de sucesso/erro globais -->
  <div class="message-container" *ngIf="showSuccessMessage || showErrorMessage">
    <div class="success-message" *ngIf="showSuccessMessage">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
      </svg>
      {{ successMessageText }}
    </div>
    
    <div class="error-message" *ngIf="showErrorMessage">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
      </svg>
      {{ errorMessageText }}
    </div>
  </div>

  <!-- Container da tabela com controles integrados -->
  <div class="table-container">
    <!-- Controles DENTRO do container da tabela -->
    <div class="table-controls">
      <div class="left-controls">
        <label for="statusFilter">Filtrar por Status:</label>
        <select id="statusFilter" [(ngModel)]="statusFilter" (change)="onStatusFilterChange()">
          <option value="all">Todos</option>
          <option value="Ativo">Ativo</option>
          <option value="Inativo">Inativo</option>
        </select>
      </div>

      <div class="right-controls">
        <label for="searchTerm">Buscar por Nome:</label>
        <input 
          type="text" 
          id="searchTerm"
          [(ngModel)]="searchTerm" 
          (input)="onSearchChange()"
          placeholder="Digite o nome do curso"
        >
        <button class="export-button" (click)="exportToExcel()">Buscar</button>
      </div>
    </div>

    <!-- Tabela de cursos -->
    <div class="table-responsive">
      <table class="data-table">
        <thead>
          <tr>
            <th>NOME</th>
            <th>DESCRIÇÃO</th>
            <th>CARGA HORÁRIA</th>
            <th>STATUS</th>
            <th class="text-center">AÇÕES</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngIf="loading">
            <td colspan="5" class="text-center">Carregando cursos...</td>
          </tr>
          <tr *ngIf="!loading && paginatedCursos.length === 0">
            <td colspan="5" class="text-center">Nenhum curso encontrado.</td>
          </tr>
          <tr *ngFor="let curso of paginatedCursos">
            <td>{{ curso.nome }}</td>
            <td>{{ curso.descricao || 'Sem descrição' }}</td>
            <td>{{ curso.carga_horaria }}h</td>
            <td>
              <span class="status-badge" [ngClass]="'status-' + (curso.status?.toLowerCase() || 'ativo')">
                {{ curso.status }}
              </span>
            </td>
            <td class="text-center">
              <button class="action-button edit-button" (click)="openCursoDialog(curso)" title="Editar">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                </svg>
              </button>
              <button class="action-button delete-button" (click)="deleteCurso(curso)" title="Deletar">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                </svg>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Paginator -->
    <div class="pagination-container">
      <div class="pagination-info">
        <div class="items-per-page">
          <label for="itemsPerPage">Itens por página:</label>
          <select 
            id="itemsPerPage" 
            [(ngModel)]="itemsPerPage" 
            (change)="onPageSizeChange()"
          >
            <option value="5">5</option>
            <option value="10">10</option>
            <option value="25">25</option>
            <option value="50">50</option>
          </select>
        </div>
      </div>

      <div class="pagination-range">
        <span>{{ getStartIndex() }} - {{ getEndIndex() }} de {{ filteredCursos.length }}</span>
      </div>

      <div class="pagination-controls">
        <button 
          class="pagination-btn" 
          [disabled]="currentPage === 1"
          (click)="goToPage(1)"
          title="Primeira página"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="m11 17-5-5 5-5M18 17l-5-5 5-5"/>
          </svg>
        </button>

        <button 
          class="pagination-btn" 
          [disabled]="currentPage === 1"
          (click)="goToPrevious()"
          title="Página anterior"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="m15 18-6-6 6-6"/>
          </svg>
        </button>

        <button 
          class="pagination-btn" 
          [disabled]="currentPage === totalPages"
          (click)="goToNext()"
          title="Próxima página"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="m9 18 6-6-6-6"/>
          </svg>
        </button>

        <button 
          class="pagination-btn" 
          [disabled]="currentPage === totalPages"
          (click)="goToPage(totalPages)"
          title="Última página"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="m6 17 5-5-5-5M13 17l5-5-5-5"/>
          </svg>
        </button>
      </div>
    </div>

  </div>
</div>

<!-- Modal de curso (mantém igual) -->
<div class="modal-overlay" [class.active]="showCursoDialog" *ngIf="showCursoDialog">
  <div class="modal-dialog" [class.active]="showCursoDialog">
    <div class="modal-header">
      <h2>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="modal-icon">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
        </svg>
        {{ isEditMode ? 'Editar Curso' : 'Adicionar Curso' }}
      </h2>
      <button class="close-modal-btn" (click)="closeCursoDialog()">×</button>
    </div>

    <div class="modal-body">
      <!-- Mensagens do modal -->
      <div class="message-container" *ngIf="showSuccessMessage || showErrorMessage">
        <div class="success-message" *ngIf="showSuccessMessage">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
          </svg>
          {{ successMessageText }}
        </div>
        
        <div class="error-message" *ngIf="showErrorMessage">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
          {{ errorMessageText }}
        </div>
      </div>

      <!-- Formulário do curso -->
      <div class="form-group">
        <label for="nome">Nome do Curso *</label>
        <input 
          type="text" 
          id="nome"
          [(ngModel)]="cursoForm.nome" 
          class="form-control"
          [class.error]="formErrors.nome"
          placeholder="Digite o nome do curso"
        >
        <span class="error-text" *ngIf="formErrors.nome">{{ formErrors.nome }}</span>
      </div>

      <div class="form-group">
        <label for="descricao">Descrição</label>
        <textarea 
          id="descricao"
          [(ngModel)]="cursoForm.descricao" 
          class="form-control"
          rows="3"
          placeholder="Digite uma descrição para o curso"
        ></textarea>
      </div>

      <div class="form-group">
        <label for="carga_horaria">Carga Horária (horas)</label>
        <input 
          type="number" 
          id="carga_horaria"
          [(ngModel)]="cursoForm.carga_horaria" 
          class="form-control"
          [class.error]="formErrors.carga_horaria"
          min="0"
          placeholder="0"
        >
        <span class="error-text" *ngIf="formErrors.carga_horaria">{{ formErrors.carga_horaria }}</span>
      </div>

      <div class="form-group">
        <label for="status">Status *</label>
        <select 
          id="status"
          [(ngModel)]="cursoForm.status" 
          class="form-select"
          [class.error]="formErrors.status"
        >
          <option value="">Selecione um status</option>
          <option *ngFor="let status of statusOptions" [value]="status.value">
            {{ status.label }}
          </option>
        </select>
        <span class="error-text" *ngIf="formErrors.status">{{ formErrors.status }}</span>
      </div>
    </div>

    <div class="modal-actions">
      <button class="cancel-button" (click)="closeCursoDialog()" [disabled]="cursoLoading">
        Cancelar
      </button>
      <button class="save-button" (click)="saveCurso()" [disabled]="cursoLoading">
        <span *ngIf="cursoLoading" class="loading-spinner"></span>
        {{ isEditMode ? 'Atualizar' : 'Salvar' }}
      </button>
    </div>
  </div>
</div>